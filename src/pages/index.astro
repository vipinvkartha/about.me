---
import Layout from '../layouts/Layout.astro';
import ScrollReveal from '../components/ScrollReveal.astro';

const profile = {
  name: "Vipin V Kartha",
  firstName: "Vipin",
  pronunciation: {
    phonetic: "vi-pin",
    audio: "/audio/vipin.mp3"
  },
  title: "Senior Backend Engineer",
  location: "Berlin, Germany",
  contact: {
    phone: "(+49) 1781723761",
    email: "vipinvkartha@gmail.com",
    linkedin: "https://linkedin.com/in/vipinvkartha",
    github: "https://github.com/vipinvkartha"
  },
  summary: `Senior Backend Engineer with 9+ years of experience building scalable systems at Babbel GmbH and other tech companies.

Specialized in:
• Microservice architecture & distributed systems
• Cloud infrastructure (AWS) & DevOps
• Backend development (Golang, Node.js, Ruby)
• System design & performance optimization

Known for delivering robust solutions that balance technical excellence with business objectives.`,
  skills: {
    core: [
      { name: "Golang", level: 5 },
      { name: "Node.js/TypeScript", level: 4 },
      { name: "Ruby on Rails", level: 4 },
      { name: "REST/GraphQL APIs", level: 5 }
    ],
    cloud: [
      { name: "AWS Services", level: 4 },
      { name: "Docker", level: 4 },
      { name: "Microservices", level: 5 },
      { name: "CI/CD", level: 4 }
    ],
    data: [
      { name: "MySQL", level: 5 },
      { name: "DynamoDB", level: 4 },
      { name: "ElasticSearch", level: 4 },
      { name: "Redis", level: 4 }
    ]
  },
  experience: [
    {
      company: "Babbel GmbH",
      location: "Berlin, Germany",
      title: "Senior Backend Engineer",
      period: "July 2022 - Current",
      highlights: [
        "Working on the authentication team, utilizing Ruby on Rails, GoLang, TypeScript, AWS, and MySQL",
        "Developing and maintaining microservice architecture to enhance scalability and performance of authentication services",
        "Collaborating closely with the infrastructure team",
        "Lead multiple initiatives including Captcha implementation for entire backend"
      ]
    },
    {
      company: "KeyValue Software Systems",
      location: "Kochi, Kerala",
      title: "Senior Software Engineer, Staff Software Engineer",
      period: "April 2020 - July 2022",
      highlights: [
        "Built B2B product for small retail owners across Indonesia using NodeJS with TypeScript and GoLang",
        "Implemented microservice architecture on AWS cloud infrastructure",
        "Developed REST and GraphQL APIs, managed deployments using AWS CodePipeline",
        "Implemented service monitoring using AWS CloudWatch",
        "Built asynchronous operations using AWS SQS and S3"
      ]
    },
    {
      company: "Siemens Technology and Services",
      location: "Bangalore, India",
      title: "Software Engineer (L2)",
      period: "Nov 2018 - April 2020",
      highlights: [
        "Backend Developer for IoT-based industrial devices project",
        "Worked with C, C++ and NodeJS",
        "Implemented various protocols including HART, MODBUS, OPCUA",
        "Developed REST APIs",
        "Handled physical layer hardware communication using RS485 and RS232 via Modbus protocol"
      ]
    },
    {
      company: "CitiusTech Healthcare Technology Pvt Ltd",
      location: "Mumbai, India",
      title: "Software Engineer",
      period: "Sep 2017 - Nov 2018",
      highlights: [
        "Enhanced and maintained healthcare domain image viewer application",
        "Specialized in VC++ and MFC development",
        "Improved application performance and fixed critical defects"
      ]
    },
    {
      company: "HCL Technologies",
      location: "Pune, India",
      title: "Software Engineer",
      period: "Oct 2016 - July 2017",
      highlights: [
        "Developed DFMPRO product using VC++ and CAA V6",
        "Integrated DFMPRO with CATIA (CAD software)",
        "Improved product functionality and user experience"
      ]
    },
    {
      company: "Aricent Technologies",
      location: "Chennai, India",
      title: "Software Engineer",
      period: "Sep 2014 - Sep 2016",
      highlights: [
        "Maintained and developed customer product for live traffic decoding and analysis",
        "Worked with C++ for both Linux and Windows platforms",
        "Implemented cross-platform solutions and optimizations"
      ]
    }
  ]
};
---

<Layout title={`${profile.name} - ${profile.title}`}>
  <main class="min-h-screen bg-zinc-950 py-12 px-4 text-zinc-100">
    <div class="max-w-3xl mx-auto space-y-20">
      <!-- Profile Header -->
      <ScrollReveal class="section-card">
        <header class="section-content p-8 rounded-lg">
          <div class="flex flex-col items-center">
            <!-- Profile Image -->
            <div class="mb-10 relative group">
              <div class="absolute -inset-1 bg-gradient-to-r from-zinc-500 to-zinc-600 rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
              <div class="relative w-44 h-44 md:w-52 md:h-52 rounded-full overflow-hidden border-2 border-zinc-800/50 p-0.5">
                <img
                  src="/profile.jpg"
                  alt="Vipin V Kartha"
                  class="w-full h-full object-cover rounded-full filter transition-all duration-500 group-hover:scale-105"
                />
              </div>
            </div>

            <!-- Profile Info -->
            <h1 class="text-4xl font-light mb-2 tracking-wide">{profile.name}</h1>
            <div class="flex items-center gap-2 mb-3">
              <span class="text-sm text-zinc-400 font-light tracking-wide" title="How to pronounce Vipin">
                /{profile.pronunciation.phonetic}/
              </span>
              <button 
                id="pronounceButton"
                class="text-zinc-500 hover:text-zinc-300 transition-colors relative group"
                title="Listen to pronunciation"
                aria-label="Listen to name pronunciation"
              >
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path 
                    stroke-linecap="round" 
                    stroke-linejoin="round" 
                    stroke-width="2" 
                    d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707C10.923 3.663 12 4.109 12 5v14c0 .891-1.077 1.337-1.707.707L5.586 15z"
                  />
                </svg>
                <span class="absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-zinc-400 rounded-full opacity-0 group-hover:opacity-100 transition-opacity"></span>
              </button>
              <audio id="pronounceAudio" src={profile.pronunciation.audio} preload="auto"></audio>
            </div>
            <p class="text-lg text-zinc-400 mb-2">{profile.title}</p>
            <p class="text-sm text-zinc-500 mb-8">{profile.location}</p>
            
            <div class="flex flex-col items-center gap-6">
              <!-- Contact Links -->
              <div class="flex justify-center gap-8 text-sm">
                {Object.entries(profile.contact).map(([key, value]) => (
                  <a 
                    href={key === 'email' ? `mailto:${value}` : key === 'phone' ? `tel:${value}` : value} 
                    target={key === 'linkedin' || key === 'github' ? '_blank' : undefined}
                    class="text-zinc-400 hover:text-zinc-100 transition-colors duration-300"
                  >
                    {key === 'linkedin' ? 'LinkedIn' : key === 'github' ? 'GitHub' : value}
                  </a>
                ))}
              </div>

              <!-- Download CV Button -->
              <div class="flex gap-3">
                <a
                  href="/vipin_kartha_cv.pdf"
                  download
                  class="inline-flex items-center gap-2 px-4 py-2 text-sm text-zinc-300 border border-zinc-800 rounded-md hover:bg-zinc-800/50 hover:border-zinc-700 transition-all duration-300"
                >
                  <span>Download CV</span>
                  <svg 
                    class="w-4 h-4" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                  >
                    <path 
                      stroke-linecap="round" 
                      stroke-linejoin="round" 
                      stroke-width="2" 
                      d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                    />
                  </svg>
                </a>

                <button
                  id="previewCV"
                  class="inline-flex items-center gap-2 px-4 py-2 text-sm text-zinc-300 border border-zinc-800 rounded-md hover:bg-zinc-800/50 hover:border-zinc-700 transition-all duration-300"
                >
                  <span>Preview CV</span>
                  <svg 
                    class="w-4 h-4" 
                    fill="none" 
                    stroke="currentColor" 
                    viewBox="0 0 24 24"
                  >
                    <path 
                      stroke-linecap="round" 
                      stroke-linejoin="round" 
                      stroke-width="2" 
                      d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
                    />
                    <path 
                      stroke-linecap="round" 
                      stroke-linejoin="round" 
                      stroke-width="2" 
                      d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"
                    />
                  </svg>
                </button>
              </div>
            </div>
          </div>
        </header>
      </ScrollReveal>

      <!-- About -->
      <ScrollReveal class="section-card">
        <section class="section-content p-8 rounded-lg">
          <h2 class="text-sm uppercase tracking-widest text-zinc-500 mb-6">About</h2>
          <div class="text-zinc-300 leading-relaxed space-y-4 font-light">
            {profile.summary.split('\n\n').map((paragraph) => (
              <p class={paragraph.startsWith('•') ? 'space-y-3' : ''}>
                {paragraph.includes('•') 
                  ? paragraph.split('•').map((item, index) => 
                      index === 0 
                        ? item 
                        : <div key={index} class="flex gap-3 text-zinc-400">
                            <span class="text-zinc-600">―</span>
                            <span>{item.trim()}</span>
                          </div>
                    )
                  : paragraph
                }
              </p>
            ))}
          </div>
        </section>
      </ScrollReveal>

      <!-- Skills -->
      <ScrollReveal class="section-card">
        <section class="section-content p-8 rounded-lg">
          <h2 class="text-sm uppercase tracking-widest text-zinc-500 mb-6">Skills</h2>
          <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
            {Object.entries(profile.skills).map(([category, skills]) => (
              <div>
                <h3 class="text-zinc-400 text-sm mb-3 capitalize">{category}</h3>
                <div class="space-y-1.5">
                  {skills.map(skill => (
                    <div class="flex items-center gap-2 text-sm">
                      <span class="text-zinc-300 flex-1">{skill.name}</span>
                      <div class="flex gap-1">
                        {[1, 2, 3, 4, 5].map((star) => (
                          <span class={`${star <= skill.level ? 'text-zinc-300' : 'text-zinc-800'} text-[10px]`}>
                            ●
                          </span>
                        ))}
                      </div>
                    </div>
                  ))}
                </div>
              </div>
            ))}
          </div>
        </section>
      </ScrollReveal>

      <!-- Experience -->
      <ScrollReveal class="section-card">
        <section class="section-content p-8 rounded-lg">
          <h2 class="text-sm uppercase tracking-widest text-zinc-500 mb-6">Experience</h2>
          
          <div class="timeline-flow">
            {profile.experience.map((job, index) => (
              <div class="timeline-item">
                <!-- Timeline Node -->
                <div class="timeline-node"></div>

                <!-- Curved Connecting Line -->
                <div class="timeline-curve"></div>

                <!-- Content -->
                <div class="timeline-content">
                  <div class="timeline-content-inner">
                    <div class="timeline-header">
                      <div class="timeline-company">
                        <h3 class="text-xl text-zinc-200 font-light">{job.company}</h3>
                        <p class="text-sm text-zinc-400">{job.title}</p>
                      </div>
                      <div class="timeline-details">
                        <time class="text-sm text-zinc-500 block">{job.period}</time>
                        <p class="text-sm text-zinc-600 mt-1">{job.location}</p>
                      </div>
                    </div>
                    
                    <ul class="space-y-2 text-sm text-zinc-400 mt-4">
                      {job.highlights.map(highlight => (
                        <li class="flex items-start gap-3">
                          <span class="text-zinc-700 mt-1.5">―</span>
                          <span class="flex-1">{highlight}</span>
                        </li>
                      ))}
                    </ul>
                  </div>
                </div>
              </div>
            ))}
          </div>
        </section>
      </ScrollReveal>
    </div>
  </main>
</Layout>

<div id="cvModal" class="fixed inset-0 bg-black/80 z-50 hidden overflow-y-auto">
  <div class="min-h-screen px-4 flex items-center justify-center">
    <div class="bg-zinc-900 rounded-lg max-w-4xl w-full relative">
      <!-- Header -->
      <div class="flex justify-between items-center p-4 border-b border-zinc-800">
        <h3 class="text-lg font-medium text-zinc-200">Curriculum Vitae</h3>
        <button 
          id="closeModal" 
          class="text-zinc-400 hover:text-zinc-200 transition-colors"
          aria-label="Close modal"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
      
      <!-- Content -->
      <div class="p-6">
        <object
          data="/vipin_kartha_cv.pdf"
          type="application/pdf"
          class="w-full h-[calc(100vh-12rem)] rounded"
        >
          <p class="text-zinc-400 text-center py-8">
            Unable to display PDF. 
            <a 
              href="/vipin_kartha_cv.pdf" 
              download 
              class="text-blue-400 hover:text-blue-300 underline"
            >
              Download instead
            </a>
          </p>
        </object>
      </div>
    </div>
  </div>
</div>

<script>
  const modal = document.getElementById('cvModal');
  const previewButton = document.getElementById('previewCV');
  const closeButton = document.getElementById('closeModal');

  // Open modal
  previewButton?.addEventListener('click', () => {
    modal?.classList.remove('hidden');
    document.body.style.overflow = 'hidden';
  });

  // Close modal
  closeButton?.addEventListener('click', () => {
    modal?.classList.add('hidden');
    document.body.style.overflow = 'auto';
  });

  // Close on outside click
  modal?.addEventListener('click', (e) => {
    if (e.target === modal) {
      modal.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  });

  // Close on escape key
  document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape' && !modal?.classList.contains('hidden')) {
      modal?.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  });

  // Pronunciation audio playback
  const pronounceButton = document.getElementById('pronounceButton');
  const pronounceAudio = document.getElementById('pronounceAudio');
  let isPlaying = false;

  if (pronounceButton && pronounceAudio) {
    pronounceButton.addEventListener('click', () => {
      if (!isPlaying) {
        isPlaying = true;
        pronounceButton.classList.add('text-zinc-300');
        
        pronounceAudio.play().catch(error => {
          console.error('Error playing audio:', error);
        });

        pronounceAudio.addEventListener('ended', () => {
          isPlaying = false;
          pronounceButton.classList.remove('text-zinc-300');
        }, { once: true });
      }
    });
  }
</script>